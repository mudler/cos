requires:
- name: "cos-config-tmpl" 
  category: "utils"
  version: ">=0"
- name: "cos-config" 
  category: "system"
  version: ">=0"

steps:
- mkdir -p /system/oem
- cp -rfv oem/{{.Values.oem_file}} /system/oem
- chmod -R 600 /system/oem
{{ if .Values.templated }}
- cos-tmpl-render /system/oem/{{.Values.oem_file}}
{{ end }}

{{ if eq .Values.oem_file "02_upgrades.yaml" }}
{{ if .Values.codename }}
- sed -i 's/:FLAVOR:/{{.Values.codename}}/g' /system/oem/02_upgrades.yaml
{{end}}
{{ if .Values.arch }}
  {{if eq .Values.arch "x86_64"}}
- sed -i 's/:ARCH://g' /system/oem/02_upgrades.yaml
  {{end}}
  {{if eq .Values.arch "aarch64"}}
- sed -i 's/:ARCH:/-arm64/g' /system/oem/02_upgrades.yaml
  {{end}}
{{end}}
{{ end }}